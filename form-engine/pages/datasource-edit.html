<!-- 新增/编辑数据源页面 -->
<div class="page-container">
    <div class="page-header">
        <h1 class="page-title">新增数据源</h1>
    </div>

    <div class="page-content">
        <div class="form-container" style="max-width: 800px; margin: 0 auto;">
            
            <!-- 基础信息 -->
            <div class="form-section">
                <div class="form-row">
                    <label class="form-label required">数据源类型：<span class="note-marker">6</span></label>
                    <select class="form-select" id="datasourceType">
                        <option value="database">数据库</option>
                        <option value="platform">集成平台</option>
                    </select>
                </div>

                <div class="form-row">
                    <label class="form-label required">应用名称：<span class="note-marker">7</span></label>
                    <select class="form-select">
                        <option>请选择</option>
                        <option>OA</option>
                        <option>PC门户</option>
                        <option>脚手架</option>
                    </select>
                </div>

                <div class="form-row">
                    <label class="form-label required">数据源名称：</label>
                    <input type="text" class="form-input" placeholder="请输入 0/30" maxlength="30">
                </div>
            </div>

            <!-- 数据库类型配置 -->
            <div id="databaseConfig">
                <div class="form-section">
                    <h3>数据库配置</h3>
                    
                    <div class="form-row">
                        <label class="form-label required">数据库类型：</label>
                        <select class="form-select">
                            <option>sqlserver</option>
                            <option>oracle</option>
                            <option selected>mysql</option>
                            <option>PostgreSQL</option>
                            <option>MongoDB</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <label class="form-label required">版本：<span class="note-marker">8</span></label>
                        <select class="form-select">
                            <option>请选择</option>
                            <option>MySQL:8.x</option>
                            <option>MySQL:5.7.x</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <label class="form-label required">数据库名称：<span class="note-marker">1</span></label>
                        <input type="text" class="form-input" placeholder="请输入 0/30" maxlength="30">
                    </div>

                    <div class="form-row">
                        <label class="form-label">连接url：
                            <span class="help-icon" title="是否使用自定义连接字符串">
                                <span class="note-marker">3</span>?
                            </span>
                        </label>
                        <div class="radio-group">
                            <label><input type="radio" name="useUrl" value="no" checked> 否</label>
                            <label><input type="radio" name="useUrl" value="yes"> 是</label>
                        </div>
                    </div>

                    <!-- 连接url为否时显示 -->
                    <div id="manualConfig">
                        <div class="form-row">
                            <label class="form-label required">服务器IP：</label>
                            <input type="text" class="form-input" placeholder="请输入">
                        </div>

                        <div class="form-row">
                            <label class="form-label required">端口号：</label>
                            <input type="text" class="form-input" placeholder="请输入">
                        </div>
                    </div>

                    <!-- 连接url为是时显示 -->
                    <div id="urlConfig" style="display: none;">
                        <div class="form-row">
                            <label class="form-label required">连接字符串：
                                <span class="help-icon" title="完整的数据库连接字符串">
                                    <span class="note-marker">10</span>?
                                </span>
                            </label>
                            <input type="text" class="form-input" placeholder="请输入">
                        </div>
                    </div>

                    <div class="form-row">
                        <label class="form-label required">用户名：</label>
                        <input type="text" class="form-input" placeholder="请输入">
                    </div>

                    <div class="form-row">
                        <label class="form-label required">密钥：</label>
                        <input type="password" class="form-input" placeholder="请输入">
                    </div>

                    <div class="form-row">
                        <label class="form-label">连接池：
                            <span class="help-icon" title="是否启用连接池">
                                <span class="note-marker">4</span>?
                            </span>
                        </label>
                        <div class="radio-group">
                            <label><input type="radio" name="usePool" value="no" checked> 否</label>
                            <label><input type="radio" name="usePool" value="yes"> 是</label>
                        </div>
                    </div>

                    <div class="form-row">
                        <label class="form-label">连接最大连接时间：</label>
                        <input type="text" class="form-input" value="5000" style="width: 120px;">
                        <span style="margin-left: 5px;">ms</span>
                    </div>

                    <div class="form-row">
                        <label class="form-label">连接池最大连接时间：</label>
                        <input type="text" class="form-input" value="12000" style="width: 120px;">
                        <span style="margin-left: 5px;">ms</span>
                    </div>
                </div>
            </div>

            <!-- 集成平台配置 -->
            <div id="platformConfig" style="display: none;">
                <div class="form-section">
                    <h3>集成平台配置</h3>
                    
                    <div class="form-row">
                        <label class="form-label required">应用描述：</label>
                        <input type="text" class="form-input" placeholder="请输入集成平台的应用名称 0/30" maxlength="30">
                    </div>

                    <div class="form-row">
                        <label class="form-label required">APPKey：<span class="note-marker">5</span></label>
                        <input type="text" class="form-input" placeholder="请输入">
                    </div>

                    <div class="form-row">
                        <label class="form-label required">APPSecret：</label>
                        <input type="text" class="form-input" placeholder="请输入">
                    </div>
                </div>
            </div>

            <!-- 操作按钮 -->
            <div class="form-actions">
                <button class="btn btn-default" onclick="history.back()">
                    取消<span class="note-marker">8</span>
                </button>
                <button class="btn btn-primary">
                    连接测试<span class="note-marker">9</span>
                </button>
                <button class="btn btn-primary">
                    保存<span class="note-marker">2</span>
                </button>
            </div>
        </div>

        <!-- 原型说明 -->
        <div class="prototype-notes" style="margin-top: 40px;">
            <h3>原型说明：</h3>
            
            <div class="note-section">
                <h4>页面字段显示说明</h4>
                
                <h5>1.1 数据源类型为数据库</h5>
                <h6>1.1.1 全部情况都需显示字段</h6>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>字段名称</th>
                            <th>字段类型</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>数据源类型</td>
                            <td>枚举</td>
                            <td>必填，枚举值为数据库、集成平台</td>
                        </tr>
                        <tr>
                            <td>应用名称</td>
                            <td>枚举</td>
                            <td>必填，枚举值为统一后台管理拉取的应用名称</td>
                        </tr>
                        <tr>
                            <td>数据源名称</td>
                            <td>文本</td>
                            <td>必填，前端支持录入最大字符为30，数据源名称不可重复</td>
                        </tr>
                        <tr>
                            <td>数据库类型</td>
                            <td>枚举</td>
                            <td>必填，枚举值为数据字典维护</td>
                        </tr>
                        <tr>
                            <td>版本</td>
                            <td>枚举</td>
                            <td>必填，枚举值为数据字典维护，不同数据库类型的版本不同</td>
                        </tr>
                        <tr>
                            <td>连接url</td>
                            <td>布尔值</td>
                            <td>必填，初始默认为否</td>
                        </tr>
                        <tr>
                            <td>数据库名称</td>
                            <td>文本</td>
                            <td>必填，前端支持录入最大字符为30</td>
                        </tr>
                        <tr>
                            <td>用户名</td>
                            <td>文本</td>
                            <td>必填</td>
                        </tr>
                        <tr>
                            <td>密钥</td>
                            <td>文本</td>
                            <td>必填</td>
                        </tr>
                        <tr>
                            <td>连接池</td>
                            <td>布尔值</td>
                            <td>初始默认为否</td>
                        </tr>
                        <tr>
                            <td>最大连接时间</td>
                            <td>整数</td>
                            <td>初始默认为5000，单位：ms</td>
                        </tr>
                        <tr>
                            <td>连接池最大连接时间</td>
                            <td>整数</td>
                            <td>初始默认为12000，单位：ms</td>
                        </tr>
                    </tbody>
                </table>

                <h6>1.1.2 连接url为是时需额外显示字段</h6>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>字段名称</th>
                            <th>字段类型</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>连接字符串</td>
                            <td>字符串</td>
                            <td>当连接url为是时，该字段必填</td>
                        </tr>
                    </tbody>
                </table>

                <h6>1.1.3 连接url为否时需额外显示字段</h6>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>字段名称</th>
                            <th>字段类型</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>服务器IP</td>
                            <td>文本</td>
                            <td>当连接url为否时，该字段必填</td>
                        </tr>
                        <tr>
                            <td>端口号</td>
                            <td>文本</td>
                            <td>当连接url为否时，该字段必填</td>
                        </tr>
                    </tbody>
                </table>

                <h5>1.2 数据源类型为集成平台</h5>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>字段名称</th>
                            <th>字段类型</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>数据源类型</td>
                            <td>枚举</td>
                            <td>必填，枚举值为数据库、集成平台</td>
                        </tr>
                        <tr>
                            <td>应用描述</td>
                            <td>文本</td>
                            <td>数据源类型为集成平台时该字段必填，前端支持录入最大字符为30</td>
                        </tr>
                        <tr>
                            <td>数据源名称</td>
                            <td>文本</td>
                            <td>必填，前端支持录入最大字符为30，数据源名称不可重复</td>
                        </tr>
                        <tr>
                            <td>APPKey</td>
                            <td>文本</td>
                            <td>数据源类型为集成平台时，该字段必填</td>
                        </tr>
                        <tr>
                            <td>APPSecret</td>
                            <td>文本</td>
                            <td>数据源类型为集成平台时，该字段必填</td>
                        </tr>
                    </tbody>
                </table>

                <p><strong>注：</strong>数据库类型为Oracle，需要传Schema（模式），传值为数据库名</p>
            </div>

            <div class="note-section">
                <h4>注释说明</h4>
                
                <p><strong><span class="note-marker">1</span> 数据库名称：</strong></p>
                <ul>
                    <li>必填字段，最多30个字符</li>
                </ul>

                <p><strong><span class="note-marker">2</span> 保存：</strong></p>
                <ul>
                    <li>点击保存需验证所有必填字段</li>
                    <li>保存成功后返回数据源管理列表</li>
                </ul>

                <p><strong><span class="note-marker">3</span> 连接url：</strong></p>
                <ul>
                    <li>选择是：显示连接字符串输入框，隐藏服务器IP和端口号</li>
                    <li>选择否：显示服务器IP和端口号，隐藏连接字符串</li>
                </ul>

                <p><strong><span class="note-marker">4</span> 连接池：</strong></p>
                <ul>
                    <li>是否启用连接池</li>
                </ul>

                <p><strong><span class="note-marker">5</span> APPKey：</strong></p>
                <ul>
                    <li>集成平台专用，必填</li>
                </ul>

                <p><strong><span class="note-marker">6</span> 数据源类型：</strong></p>
                <ul>
                    <li>切换数据源类型会切换不同的表单配置</li>
                </ul>

                <p><strong><span class="note-marker">7</span> 应用名称：</strong></p>
                <ul>
                    <li>从统一后台管理拉取应用列表</li>
                </ul>

                <p><strong><span class="note-marker">8</span> 取消：</strong></p>
                <ul>
                    <li>返回数据源管理列表</li>
                </ul>

                <p><strong><span class="note-marker">9</span> 连接测试：</strong></p>
                <ul>
                    <li>测试数据库连接是否成功</li>
                </ul>

                <p><strong><span class="note-marker">10</span> 连接字符串：</strong></p>
                <ul>
                    <li>完整的数据库连接字符串</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
// 数据源类型切换
document.getElementById('datasourceType').addEventListener('change', function() {
    const databaseConfig = document.getElementById('databaseConfig');
    const platformConfig = document.getElementById('platformConfig');
    
    if (this.value === 'database') {
        databaseConfig.style.display = 'block';
        platformConfig.style.display = 'none';
    } else {
        databaseConfig.style.display = 'none';
        platformConfig.style.display = 'block';
    }
});

// 连接URL切换
document.querySelectorAll('input[name="useUrl"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const manualConfig = document.getElementById('manualConfig');
        const urlConfig = document.getElementById('urlConfig');
        
        if (this.value === 'yes') {
            manualConfig.style.display = 'none';
            urlConfig.style.display = 'block';
        } else {
            manualConfig.style.display = 'block';
            urlConfig.style.display = 'none';
        }
    });
});
</script>

<style>
.form-container {
    background: #fff;
    padding: 24px;
    border-radius: 4px;
}

.form-section {
    margin-bottom: 24px;
    padding: 16px;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
}

.form-section h3 {
    margin: 0 0 16px 0;
    font-size: 16px;
    font-weight: 600;
    color: #333;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 8px;
}

.form-section h5, .form-section h6 {
    margin: 16px 0 8px 0;
    color: #666;
}

.form-row {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
}

.form-label {
    min-width: 180px;
    color: #333;
    font-weight: 500;
}

.form-label.required::before {
    content: '* ';
    color: #f56c6c;
}

.help-icon {
    cursor: help;
    color: #409eff;
    margin-left: 4px;
}

.radio-group {
    display: flex;
    gap: 16px;
}

.radio-group label {
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
}

.form-actions {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-top: 24px;
    padding-top: 24px;
    border-top: 1px solid #e0e0e0;
}
</style>

